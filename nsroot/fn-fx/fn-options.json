{
  "prefix": "fn options",
  "body": [
    "# Usage: options=(\"one\" \"two\" \"three\"); chooseOption \"Choose:\" 1 \"\\${options[@]}\"; choice=\\$?; echo \"\\${options[\\$choice]}\"\n",
    "function chooseOption() {",
    "\techo \"\\$1\"; shift",
    "\techo \\$(tput sitm\\$(\\$(tput dim)-\"Change selection: [up/down]  Select: [ENTER]\" )tput sgr0)",
    "\tlocal selected=\"\\$1\"; shift\n",
    "\tESC=\\$(echo -e \"\\033\")",
    "\tcursor_blink_on()  { tput cnorm; }",
    "\tcursor_blink_off() { tput civis; }",
    "\tcursor_to()        { tput cup \\$((\\$1-1)); }",
    "\tprint_option()     { echo  \\$(tput dim\\$( \"   \\$1\" )tput sgr0); }",
    "\tprint_selected()   { echo \\$(tput bold\\$( \"=> \\$1\" )tput sgr0); }",
    "\tget_cursor_row()   { IFS=';' read -sdR -p \\$'\\E[6n' ROW COL; echo \\${ROW#*[}; }",
    "\tkey_input()        { read -s -n3 key 2>/dev/null >&2; [[ \\$key = \\$ESC[A ]] && echo up; [[ \\$key = \\$ESC[B ]] && echo down; [[ \\$key = \"\" ]] && echo enter; }\n",
    "\tfor opt; do echo; done\n",
    "\tlocal lastrow=\\$(get_cursor_row)",
    "\tlocal startrow=\\$((\\$lastrow - \\$#))",
    "\ttrap \"cursor_blink_on; echo; echo; exit\" 2",
    "\tcursor_blink_off\n",
    "\t: selected:=0\n",
    "\twhile true; do",
    "\t\tlocal idx=0",
    "\t\tfor opt; do",
    "\t\t\tcursor_to \\$((\\$startrow + \\$idx))",
    "\t\t\tif [ \\$idx -eq \\$selected ]; then",
    "\t\t\t\tprint_selected \"\\$opt\"",
    "\t\t\telse",
    "\t\t\t\tprint_option \"\\$opt\"",
    "\t\t\tfi",
    "\t\t\t((idx++))",
    "\t\tdone\n",
    "\t\tcase \\$(key_input) in",
    "\t\t\tenter) break;;",
    "\t\t\tup)    ((selected--)); [ \\$selected -lt 0 ] && selected=\\$((\\$# - 1));;",
    "\t\t\tdown)  ((selected++)); [ \\$selected -ge \\$# ] && selected=0;;",
    "\t\tesac",
    "\tdone\n",
    "\tcursor_to \\$lastrow",
    "\tcursor_blink_on",
    "\techo\n",
    "\treturn \\$selected",
    "}\n"
  ],
  "description": "provide a list of options to user and return the index of selected option"
}